---
title: "Calculating stock weights"
author: "Kobus Viljoen"
date: "29 September 2016"
output: html_document
---

```{r}
knitr::opts_chunk$set(
  eval = FALSE)
```

In this file I want to calculate the weights assigned to each stock that is selected by the corresponding fundamental factor.
I'm going to use the risk parity approach.
At the ende of the stock selection process, I'm left with a tibble with the corresponding semi-annual rebalancing dates in a vector and then a list of tibbles with the selected stocks corresponding to the dates.

## Merging the selected stocks with their daily prices
```{r}
# close_price row number five consist out of the daily closing prices
## This function takes the stocks list and date into account in collecting the daily data for each selected stock
Prices <- function(df1,df2){
  Tickers <- df1 %>% select(Ticker)
  close_prices$data[[5]] %>% 
    bind_rows(.id="Ticker") %>%
    group_by(Ticker) %>%
    filter(Ticker %in% Tickers$Ticker) %>%
    filter(date <= df2) %>%
    nest()
}
## Example for the momentum model
Closing <- MOM_Model %>% 
  mutate(Prices = map2(stocks,date,Prices))
```

